<table class="color4 bold">
  <col width="25%"/>
  <col width="25%"/>
  <col width="25%"/>
  <col width="25%"/>
  <tr ng-class="{'notVisible':filename == null || filename == '' || !hasErrors}">
    <td colspan="2"></td>
    <td colspan="2" class="color3 not-bold" id="filenameContainer"><div>Current uploaded file: {{filename}}</div></td>
  </tr>
  <tr>
    <td>
        <a id="#step1Link" href="LCI-Database_Data-collection_Crop_v1.xlsx" target="_blank" onclick="documentLinkClick(event,'LCI-Database_Data-collection_Crop_v1.xlsx')">
            <div id="step1" class="stepBtn">
              <div class="stepTitle text-big text-uppercase">Step 1</div>
              <div class="stepText">Download the template</div>
            </div>
        </a>
    </td>
    <td id="step2" class="stepBtn">
        <div class="stepTitle text-big text-uppercase">Step 2</div>
        <div class="stepText">Fill in the template with your data</div>
    </td>
    <td id="step3Container" ng-class="{disabledStep: step == 1 || !isLogged}">
      <form id="processGeneratorUploadForm" method="post" enctype="multipart/form-data">
          <div id="step3" class="stepBtn">
	          <div class="stepTitle text-big text-uppercase">Step 3</div>
	          <input type="file" name="uploadFile" 
	                      accept=".xls,.xlsx" required="required" 
	                      class="upload"
	                      ng-change="submitUploadForm($event.target, $event.target.parent.parent, null)"
	                      ng-if="step == 0 && isLogged"/>
	          <div class="stepText">Upload your template to ALCIG</div>
          </div>
          <div>
             <input type="checkbox" checked name="canBeStored" value="true" ng-disabled="step != 0"/> 
            <span id="step3CheckboxText" class="text-very-small">I agree that Quantis stores this file for testing purposes</span>
          </div>
			</form>
			<div id="step3ContainerWhenDisabled" ng-click="disabledStep3Click()" ng-if="step != 0 || !isLogged"></div>
    </td>
    <td>
      <form action="app/api/generateScsv" method="post" ng-disabled="step != 1" style="display: block;">
        <div id="step4" class="stepBtn" ng-class="{disabledStep: step == 0}">
	        <div class="stepTitle text-big text-uppercase">Step 4</div>
				  <input type="submit" id="scsvDownloadBtn" ng-disabled="step != 1"/>
				  <div class="stepText">Get a ready-to-import file for Simapro</div>
			  </div>
	 	    <input type="hidden" name="generationId" value="{{lastGenerationId}}"/>
			  <div class="btn-group" data-toggle="buttons" ng-class="{'notVisible':step != 1}">
				  <label class="btn btn-primary active dbOptionLabel">
				    <input type="radio" name="dbOption" autocomplete="off" checked value="ECOINVENT">Ecoinvent
				  </label>
				  <label class="btn btn-primary dbOptionLabel">
				    <input type="radio" name="dbOption" autocomplete="off" value="WFLDB">WFLDB
				  </label>
				</div>
			</form>
	  </td>
  </tr>
  
  <tr>
    <td colspan="2"></td>
    <td>
	    <button class="qts-btn qts-btn-style2" ng-class="{'notVisible':!hasErrors && !hasWarnings(lastGeneration)}" data-toggle="modal" data-target="#process-generation-step3-modal">
	     <span class="glyphicon" ng-class="{'glyphicon-exclamation-sign':!hasErrors, 'warningsColor':!hasErrors, 'glyphicon-minus-sign':hasErrors, 'errorsColor':hasErrors}" aria-hidden="true"></span>
	     Upload status
	    </button>
    </td>
    <td><button class="qts-btn qts-btn-style1 stepNavBtn" ng-class="{'notVisible':step != 1}" ng-click="resetToStep3()">Back to step 3</button></td>
  </tr>
</table>

<table id="generationHistory" class="color1">
  <col width="12%"/>
  <col width="9%"/>
  <col width="4%"/>
  <col width="25%"/>
  <col width="25%"/>
  <col width="25%"/>
  <tr ng-repeat="generation in generations" ng-class-odd="'odd'" ng-class-even="'even'" ng-class="{'selectedGenerationRow':generation == lastGeneration}">
    <td>{{displayDate(generation.lastTryDate)}}</td>
    <td>{{generation.crop}}</td>
    <td>{{generation.country}}</td>
    <td><div style="max-width: 100%;">{{generation.filename}}</div></td>
    <td>
      <div class="qts-small-btn qts-btn-style1">
        <div >Retry upload</div>
	      <form method="post" enctype="multipart/form-data">
            <input type="file" name="uploadFile" 
                        accept=".xls,.xlsx" required="required" 
                        class="generationRowUploadForm"
                        ng-change="submitUploadForm($event.target, $event.target.parent, generation)"
                        />
	      </form>
      </div>
      <button class="qts-small-btn qts-btn-style4" ng-class="{'notVisible':!hasWarnings(generation)}" data-toggle="modal" data-target="#process-generation-step3-modal" ng-click="changeSelectedGeneration(generation)">
       <span class="glyphicon glyphicon-exclamation-sign warningsColor" aria-hidden="true"></span>
       Upload status
      </button>
    </td>
    <td class="text-center">
      <form action="app/api/generateScsv" ng-submit="changeSelectedGeneration(generation)" method="post">
        <input type="hidden" name="generationId" value="{{generation.id.representation}}"/>
        <div class="btn-group" data-toggle="buttons">
          <label class="btn btn-primary active dbOptionLabel">
            <input type="radio" name="dbOption" autocomplete="off" checked value="ECOINVENT">Ecoinvent
          </label>
          <label class="btn btn-primary dbOptionLabel">
            <input type="radio" name="dbOption" autocomplete="off" value="WFLDB">WFLDB
          </label>
        </div>
        <input type="submit" class="qts-small-btn qts-btn-style1 getScsvFileRowBtn" value="Get generated file"/>
      </form>
    </td>
  </tr>
</table>

<div id="fileLoadingModal" class="modal" data-backdrop="static" data-keyboard="false" style="width:100%; text-align: center" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <img src="img/ajax-loader-big.gif"/>
</div>

<!-- Modal -->
<div class="modal topBottomAnimation" id="process-generation-step3-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content alert" ng-class="{'successful':step == 1 ,'errors': hasErrors, 'warnings':hasWarnings(lastGeneration)}">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">
           <span class="glyphicon" ng-class="{'glyphicon-exclamation-sign':hasOnlyWarnings(lastGeneration), 'warningsColor':hasOnlyWarnings(lastGeneration), 'glyphicon-minus-sign':hasErrors, 'errorsColor':hasErrors}" aria-hidden="true"></span>
          <span ng-if="lastGeneration != null">File successfully uploaded</span>
          <span ng-if="lastGeneration == null">Sorry, we didn't manage to compute your data</span>
        </h4>
      </div>
      <div class="modal-body">
        <div ng-if="step == 1">You can now click on Step 4 to download the generated Simapro file</div>
        
        <div ng-if="hasErrors || hasWarnings(lastGeneration)">Uploaded file: {{filename}}</div>
        <div ng-if="hasErrors">Please check these points before trying again:</div>
					<table ng-if="hasErrors" class="errors-and-warnings-table">
					  <tr>
					    <th class="tableCellColumn">Cell</th>
					    <th class="tableLabelColumn">Label</th>
					    <th>Message</th>
					  </tr>
					  <tr ng-repeat="error in errors" ng-class-odd="'odd'" ng-class-even="'even'">
					    <td>{{error.context.cell}}</td>
					    <td>{{error.context.label}}</td>
					    <td>{{error.message}}</td>
					  </tr>
					</table>
					
					<div ng-if="hasWarnings(lastGeneration)">
				    <span ng-if="!hasErrors">Some data have been adapted for this computation:</span>
				    <span ng-if="hasErrors">We also noticed a few other minor points that will be adapted if you keep them unchanged:</span>
					</div>
					<table ng-if="hasWarnings(lastGeneration)" class="errors-and-warnings-table">
					  <tr>
					    <th class="tableCellColumn">Cell</th>
              <th class="tableLabelColumn">Label</th>
              <th>Message</th>
					  </tr>
					  <tr ng-repeat="warning in warnings" ng-class-odd="'odd'" ng-class-even="'even'">
					    <td>{{warning.context.cell}}</td>
					    <td>{{warning.context.label}}</td>
					    <td>{{warning.message}}</td>
					  </tr>
					</table>
      </div>
      <div class="modal-footer" ng-if="hasWarnings(lastGeneration) || hasErrors">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
